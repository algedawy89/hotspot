var ERROR_TYPES={READY_STATUS_ERROR:1,TRY_CATCH_ERROR:2},loanLoginData=$loginData,isTryLoan=!1,loanTryCount=0,$loanButton=document.getElementById("loan-button");document.addEventListener("DOMContentLoaded",function(){$loanButton.addEventListener("click",initLoan)},!1);
function initLoan(a,b){loanTryCount=0;"file:"!==window.location.protocol&&(void 0!==a&&void 0===b&&(loanLoginData=a),void 0===loanLoginData?loanRequest("/login?var=callBack",initLoan,initLoan):($loanButton.classList.add("processing"),isTrial()?loanRequest("/login?username=T-".concat(loanLoginData.mac,"&var=callBack"),onRequestSuccess,onRequestFail):showLoanError("خدمة سلفني متوقفة في الوقت الحالي")))}
function isTrial(){try{var a;return"yes"===(null!=(a=loanLoginData.trial)?a:"")}catch(b){return!1}}function onRequestFail(a,b){}
function onRequestSuccess(a){loanLoginData=a;var b=parseInt(a.session_time_left_secs);999999999123<parseInt(a.remain_bytes_total)+parseInt(a.bytes_in)?3<=loanTryCount?showLoanError("لايمكنك اخذ السلفة اذا لم تستخدم 5 كروت او اكثر بهذا الجهاز من بعد تركيب الخدمة"):setTimeout(function(){loanRequest("/login?username=T-".concat(loanLoginData.mac,"&var=callBack"),onRequestSuccess,onRequestFail);loanTryCount++},1E3*b):loanSuccess(a)}
function isLoggedIn(a){var b;return"yes"===(null!=(b=a.logged_in)?b:"")}function loanSuccess(a){var b=document.getElementById("loan");setTimeout(function(){b.classList.remove("active");b.style.display="none"},500);onLoggedIn(a);$loanButton.classList.remove("processing")}
function tryLoan(a){console.log(a);if(!isLoggedIn(a))return loanError(a);var b=parseInt(a.session_time_left_secs),c=parseInt(a.remain_bytes_total)+parseInt(a.bytes_in);console.log(b);if(999999999123<c){if(isTryLoan)return loanError(a);setTimeout(function(){loanRequest(tryLoan);isTryLoan=!0},1E3*b)}else loanSuccess(a)}
function loanRequest(a){var b=isTryLoan?"/status?var=callBack":"/login?username=T-".concat(loanLoginData.mac,"&var=callBack"),c=new XMLHttpRequest;c.open("GET",b,!0);c.onreadystatechange=function(){if(4===this.readyState){var d=this.responseText;try{var e=JSON.parse(d);void 0!==a&&a(e)}catch(f){showErrorPopup(),$loanButton.classList.remove("processing")}}};c.send()}
function loanError(a){console.log("error");console.log(a);var b=document.getElementById("error");"onLoginError"===a.action&&isTrial()&&"your traffic limit is reached"!==a.error_orig?b.innerText="لايمكنك اخذ السلفة اذا لم تستخدم 5 كروت او اكثر بهذا الجهاز من بعد تركيب الخدمة":"onLoginError"===a.action&&/invalid username|not found/.test(a.error)?b.innerText="خدمة سلفني متوقفة في الوقت الحالي":b.innerText="لايمكنك الاستلاف اكثر من مرة واحدة .. سيتم فتح السلفة مجددا حال سدادك للسلفة الاولى";showErrorPopup();
$loanButton.classList.remove("processing")}function showLoanError(a){document.getElementById("error").innerText=a;showErrorPopup();$loanButton.classList.remove("processing")}function loanRequest(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0);d.onreadystatechange=function(){if(4!==this.readyState)void 0!==c&&c(ERROR_TYPES.READY_STATUS_ERROR,this.readyState);else{var e=this.responseText;try{var f=JSON.parse(e);void 0!==b&&b(f)}catch(g){void 0!==c&&c(ERROR_TYPES.TRY_CATCH_ERROR,g)}}};d.send()};
