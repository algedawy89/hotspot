var ERROR_TYPES={READY_STATUS_ERROR:1,TRY_CATCH_ERROR:2},loanLoginData=$loginData,isTryLoan=!1,loanTryCount=0,$loanButton=document.getElementById("loan-button");document.addEventListener("DOMContentLoaded",function(){$loanButton.addEventListener("click",initLoan)},!1);
function initLoan(a,b){if("file:"!==window.location.protocol){void 0!==a&&void 0===b&&(loanLoginData=a);if(3<=loanTryCount)return showLoanError("خدمة سلفني متوقفة في الوقت الحالي");void 0===loanLoginData?loanRequest("/login?var=callBack",initLoan,initLoan):(loanTryCount=0,$loanButton.classList.add("processing"),isTrial()?loanRequest("/login?username=T-".concat(loanLoginData.mac,"&var=callBack"),onRequestSuccess,onRequestFail):showLoanError("خدمة سلفني متوقفة في الوقت الحالي"))}}
function isTrial(){try{var a;return"yes"===(null!=(a=loanLoginData.trial)?a:"")}catch(b){return!1}}function onRequestFail(a,b){showLoanError("لايمكنك اخذ السلفة اذا لم تستخدم 5 كروت او اكثر بهذا الجهاز اخر 30 يوما")}
function onRequestSuccess(a){if(!isLoggedIn(a))return loanError(a);loanLoginData=a;var b=parseInt(a.session_time_left_secs);999999999123<parseInt(a.remain_bytes_total)+parseInt(a.bytes_in)?3<=loanTryCount?showLoanError("لايمكنك اخذ السلفة اذا لم تستخدم 5 كروت او اكثر بهذا الجهاز اخر 30 يوما"):setTimeout(function(){loanRequest("/login?username=T-".concat(loanLoginData.mac,"&var=callBack"),onRequestSuccess,onRequestFail);loanTryCount++},1E3*b):loanSuccess(a)}
function isLoggedIn(a){try{var b;return"yes"===(null!=(b=a.logged_in)?b:"")}catch(c){return!1}}function loanSuccess(a){var b=document.getElementById("loan");setTimeout(function(){b.classList.remove("active");b.style.display="none"},500);onLoggedIn(a);$loanButton.classList.remove("processing")}
function loanError(a){var b="لايمكنك الاستلاف اكثر من مرة واحدة .. سيتم فتح السلفة مجددا حال سدادك للسلفة الاولى";"onLoginError"===a.action&&isTrial()&&"your traffic limit is reached"!==a.error_orig?b="لايمكنك اخذ السلفة اذا لم تستخدم 5 كروت او اكثر بهذا الجهاز اخر 30 يوما":"onLoginError"===a.action&&/invalid username|not found/.test(a.error)&&(b="خدمة سلفني متوقفة في الوقت الحالي");showLoanError(b)}
function showLoanError(a){document.getElementById("error").innerText=a;showErrorPopup();$loanButton.classList.remove("processing")}function loanRequest(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0);d.onreadystatechange=function(){if(4!==this.readyState)void 0!==c&&c(ERROR_TYPES.READY_STATUS_ERROR,this.readyState);else{var e=this.responseText;try{var f=JSON.parse(e);void 0!==b&&b(f)}catch(g){void 0!==c&&c(ERROR_TYPES.TRY_CATCH_ERROR,g)}}};d.send()};
